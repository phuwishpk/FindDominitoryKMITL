{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {# This block now generates JavaScript calls instead of old HTML alerts #}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        {% for category, message in messages %}
          {% if category != 'script_command' %}
            if (typeof createToast === 'function') {
              createToast("{{ message | escape | safe }}", "{{ category or 'info' }}");
            } else {
              console.error('Error: createToast function not found.');
            }
          {% endif %}
        {% endfor %}
      });
    </script>
    
    {# This part remains for special non-visible commands #}
    {% for category, message in messages %}
      {% if category == 'script_command' %}
        <script>
          if ('{{ message }}' === 'clear_form_storage') {
            const storageKey = `fileStore_/owner/property/new`;
            sessionStorage.removeItem(storageKey);
          }
        </script>
      {% endif %}
    {% endfor %}
  {% endif %}
{% endwith %}