{% extends 'public/public_base.html' %}

{% block content %}

<style>
  /* --- CSS ส่วนอื่นๆ สามารถคงไว้เหมือนเดิม --- */
  .header__container, .feature-section, .room-finder-section, .container.py-5 {
    visibility: hidden;
  }
  .header.fade-overlay {
    position: relative;
  }
  .header.fade-overlay::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to top, #0f1a2c 5%, transparent 90%);
    z-index: 1;
  }
  .header__container {
    position: relative;
    z-index: 2;
  }
  .feature-section {
    background-color: #f8f9fa;
    padding-top: 4rem;
    padding-bottom: 5rem;
  }
  .feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 2.5rem;
  }
  .feature-card {
    background-color: #ffffff;
    border: 1px solid #e9ecef;
    border-radius: 0.75rem;
    padding: 2rem;
    text-align: left;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .feature-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.08);
  }
  .feature-card .icon {
    margin-bottom: 1rem;
    color: #004a99;
  }
  .feature-card h5 {
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
  .feature-card p {
    color: #6c757d;
    font-size: 0.95rem;
  }
  .room-finder-section {
    padding: 5rem 0;
    background-color: #ffffff;
  }
  .room-tabs {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 3rem;
  }
  .room-tab-btn {
    background-color: #f1f5f9;
    color: #0f1a2c;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 9999px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
  }
  .room-tab-btn.active {
    background-color: #004a99;
    color: #ffffff;
  }
  .room-tab-content {
    display: none;
  }
  .room-tab-content.active {
    display: block;
  }
  .room-details-grid {
    display: grid;
    grid-template-columns: 1fr 2fr 2fr;
    align-items: center;
    gap: 2rem;
    max-width: 1000px;
    margin: auto;
  }
  .room-specs {
    background-color: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    padding: 1.5rem;
    font-family: 'Poppins', sans-serif;
  }
  .room-specs p {
    margin-bottom: 0.75rem;
  }
  .room-image-wrapper img {
    width: 100%;
    border-radius: 0.75rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }
  .room-description h4 {
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    margin-bottom: 1rem;
  }
  .room-description p {
    color: #475569;
    line-height: 1.6;
  }
  .result-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .result-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
  }

  /* --- vvv CSS ที่แก้ไขสำหรับปุ่ม Slider vvv --- */
  .slider-container {
    position: relative;
    padding: 0 30px; /* เพิ่มพื้นที่ด้านข้างสำหรับปุ่ม */
  }

  .tns-controls button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: white;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  .tns-controls button[data-controls="prev"] {
    left: 0;
  }

  .tns-controls button[data-controls="next"] {
    right: 0;
  }
  /* --- ^^^ สิ้นสุดการแก้ไข CSS ^^^ --- */
  
  @media (max-width: 992px) {
    .slider-container {
        padding: 0; /* ไม่มีพื้นที่ข้างบน Tablet และ Mobile */
    }
    .tns-controls {
        display: none; /* ซ่อนปุ่มบน Tablet และ Mobile */
    }
  }

  @media (max-width: 768px) {
    .room-details-grid {
      grid-template-columns: 1fr;
      text-align: center;
    }
  }
</style>

<header class="header fade-overlay" style="background-image: url({{ url_for('static', filename='images/header.jpg') }});">
  <div class="section__container header__container">
    <p class="section__subheader">FIND DORMITORY</p>
    <h1>หอพักที่สมบูรณ์แบบ<br />สำหรับคุณ</h1>
    <a href="{{ url_for('public.search') }}" class="btn">ดูหอพักทั้งหมด</a>
  </div>
</header>

{# --- Feature Section (เหมือนเดิม) --- #}
<section class="feature-section">
  <div class="container">
    <div class="text-center">
      <p class="section__subheader">ทำไมต้องเลือกเรา</p>
      <h2 class="section__header">แพลตฟอร์มค้นหาหอพักที่ครบวงจร</h2>
    </div>
    <div class="feature-grid">
        <div class="feature-card"><div class="icon"><i data-feather="search" style="width: 32px; height: 32px;"></i></div><h5>ค้นหาง่ายและรวดเร็ว</h5><p>ระบบกรองข้อมูลที่ละเอียด ช่วยให้คุณเจอหอพักที่ตรงใจได้ในไม่กี่คลิก</p></div>
        <div class="feature-card"><div class="icon"><i data-feather="check-square" style="width: 32px; height: 32px;"></i></div><h5>ข้อมูลเชื่อถือได้</h5><p>ทุกประกาศผ่านการตรวจสอบเบื้องต้นจากทีมงาน เพื่อความมั่นใจของคุณ</p></div>
        <div class="feature-card"><div class="icon"><i data-feather="map-pin" style="width: 32px; height: 32px;"></i></div><h5>ตำแหน่งแม่นยำ</h5><p>แสดงตำแหน่งที่ตั้งของหอพักบนแผนที่ ช่วยให้คุณวางแผนการเดินทางได้สะดวก</p></div>
    </div>
  </div>
</section>

{# --- Room Finder Section (เหมือนเดิม) --- #}
<section class="room-finder-section">
  <div class="container text-center">
    <p class="section__subheader">ตัวอย่างห้องพัก</p>
    <h2 class="section__header">ค้นหาห้องที่ใช่สำหรับคุณ</h2>
    <div class="room-tabs"><button class="room-tab-btn active" data-tab="tab-furnished">ห้องพร้อมเฟอร์นิเจอร์</button><button class="room-tab-btn" data-tab="tab-partial">ห้องกึ่งเฟอร์นิเจอร์</button><button class="room-tab-btn" data-tab="tab-empty">ห้องเปล่า</button></div>
    <div id="tab-furnished" class="room-tab-content active"><div class="room-details-grid"><div class="room-image-wrapper"><img src="{{ url_for('static', filename='images/furnished.jpg') }}" alt="Furnished Room"></div><div class="room-description text-start"><h4>ห้องพร้อมเฟอร์นิเจอร์</h4><p>เหมาะสำหรับผู้ที่ต้องการความสะดวกสบายสูงสุด แค่ย้ายกระเป๋าเข้ามาก็พร้อมอยู่ได้ทันที มาพร้อมเฟอร์นิเจอร์ครบครัน ทั้งเตียง, ตู้เสื้อผ้า, โต๊ะทำงาน และเครื่องใช้ไฟฟ้าพื้นฐาน</p></div><div class="room-specs text-start"><p><strong>เหมาะสำหรับ:</strong> นักศึกษาที่ต้องการความสะดวก</p><p><strong>ข้อดี:</strong> ไม่ต้องซื้อเฟอร์นิเจอร์เอง</p><p><strong>ราคาเฉลี่ย:</strong> 5,000 - 8,000 บาท</p></div></div></div>
    <div id="tab-partial" class="room-tab-content"><div class="room-details-grid"><div class="room-image-wrapper"><img src="{{ url_for('static', filename='images/partially-furnished.jpg') }}" alt="Partially Furnished Room"></div><div class="room-description text-start"><h4>ห้องกึ่งเฟอร์นิเจอร์</h4><p>ความลงตัวระหว่างความสะดวกสบายและการตกแต่งในสไตล์ของตัวเอง มีเฟอร์นิเจอร์ชิ้นใหญ่ให้บางส่วน เช่น เตียงหรือตู้เสื้อผ้า คุณสามารถนำของตกแต่งหรือเฟอร์นิเจอร์ชิ้นเล็กๆ เข้ามาเพิ่มได้</p></div><div class="room-specs text-start"><p><strong>เหมาะสำหรับ:</strong> ผู้ที่มีเฟอร์นิเจอร์บางส่วน</p><p><strong>ข้อดี:</strong> ยืดหยุ่นในการตกแต่ง</p><p><strong>ราคาเฉลี่ย:</strong> 4,000 - 6,500 บาท</p></div></div></div>
    <div id="tab-empty" class="room-tab-content"><div class="room-details-grid"><div class="room-image-wrapper"><img src="{{ url_for('static', filename='images/empty-room.jpg') }}" alt="Empty Room"></div><div class="room-description text-start"><h4>ห้องเปล่า</h4><p>อิสระเต็มที่ในการออกแบบและตกแต่งพื้นที่ของคุณเอง เหมาะสำหรับผู้ที่มีเฟอร์นิเจอร์ครบชุดมาแล้ว หรือต้องการสร้างสรรค์ห้องในฝันตามสไตล์ที่ไม่เหมือนใคร</p></div><div class="room-specs text-start"><p><strong>เหมาะสำหรับ:</strong> ผู้ที่ต้องการแต่งห้องเอง</p><p><strong>ข้อดี:</strong> ค่าเช่าถูกกว่า, เป็นส่วนตัว</p><p><strong>ราคาเฉลี่ย:</strong> 3,000 - 5,000 บาท</p></div></div></div>
  </div>
</section>

{# --- vvv ส่วนแสดงรายการหอพัก (Dorm List Section) ที่แก้ไขแล้ว vvv --- #}
<section class="container py-5" id="dorm-list">
    <div class="text-center mb-5">
      <p class="section__subheader">รายการแนะนำ</p>
      <h2 class="section__header">หอพักล่าสุด</h2>
    </div>

    {% if items %}
    <div class="slider-container">
        <div class="my-slider">
            {% for prop in items %}
            <div class="px-2">
                <div class="card h-100 shadow-sm result-card">
                    {% set first_image = prop.images|sort(attribute='position')|first %}
                    <a href="{{ url_for('public.property_detail', prop_id=prop.id) }}">
                        {% if first_image %}
                        <img src="/{{ first_image.file_path }}" class="card-img-top" alt="{{ prop.dorm_name }}" style="height: 180px; object-fit: cover;">
                        {% else %}
                        <div class="d-flex justify-content-center align-items-center bg-light text-muted" style="height: 180px;">
                            <i data-feather="image" style="width: 48px; height: 48px;"></i>
                        </div>
                        {% endif %}
                    </a>
                    <div class="card-body">
                        <h5 class="card-title text-truncate">
                            <a href="{{ url_for('public.property_detail', prop_id=prop.id) }}" class="text-decoration-none text-dark">{{ prop.dorm_name }}</a>
                        </h5>
                        <p class="card-text text-muted small">
                            {{ prop.soi or 'N/A' }}, ถ. {{ prop.road or 'N/A' }}
                        </p>
                        <h4 class="card-text text-primary fw-bold">
                            {{ "{:,.0f}".format(prop.rent_price) if prop.rent_price is not none else 'N/A' }} <span class="small text-muted fw-normal">บาท/เดือน</span>
                        </h4>
                    </div>
                     <div class="card-footer bg-white border-0 pb-3">
                        {% if prop.availability_status == 'vacant' %}
                            <span class="badge bg-success-subtle text-success-emphasis rounded-pill">ห้องว่าง</span>
                        {% else %}
                            <span class="badge bg-danger-subtle text-danger-emphasis rounded-pill">ห้องเต็ม</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="text-center py-5 card">
        <i data-feather="home" class="text-muted mb-3" style="width: 48px; height: 48px;"></i>
        <h4>ยังไม่มีประกาศหอพักในระบบ</h4>
        <p class="text-muted">กรุณากลับมาตรวจสอบอีกครั้งในภายหลัง</p>
    </div>
    {% endif %}
</section>
{# --- ^^^ สิ้นสุดส่วนที่แก้ไข ^^^ --- #}

{% endblock %}

{% block page_scripts %}
{{ super() }}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // โค้ดสำหรับ Tab และ ScrollReveal (เหมือนเดิม)
    const tabButtons = document.querySelectorAll('.room-tab-btn');
    const tabContents = document.querySelectorAll('.room-tab-content');
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            this.classList.add('active');
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });
    const sr = ScrollReveal({ origin: 'bottom', distance: '60px', duration: 1200, delay: 200, reset: false });
    sr.reveal('.header__container');
    sr.reveal('.feature-section', { delay: 300 });
    sr.reveal('.room-finder-section', { delay: 300 });
    sr.reveal('.container.py-5', { delay: 300 });

    if (typeof feather !== 'undefined') {
        feather.replace();
    }

    // --- vvv JavaScript สำหรับ Slider ที่แก้ไขแล้ว vvv ---
    if(document.querySelector('.my-slider')) {
        var slider = tns({
            container: '.my-slider',
            items: 1,
            slideBy: 'page',
            autoplay: false,
            mouseDrag: true,
            controls: true, // เปิดใช้งานปุ่ม
            nav: false,
            // ไม่ต้องใช้ controlsContainer แล้ว เพราะเราจะใช้ปุ่มที่ไลบรารีสร้างให้
            responsive: {
                768: { items: 3 },
                992: { items: 4 }
            }
        });
    }
    // --- ^^^ สิ้นสุดการแก้ไข JavaScript ^^^ ---
  });
</script>
{% endblock %}