{% extends 'base.html' %}
{% block content %}
<h1 class="h4 mb-4">รายการประกาศ</h1>

<div class="row row-cols-1 g-4"> 
  {% for p in items %}
  <div class="col">
    <a href="{{ url_for('public.property_detail', prop_id=p.id) }}" class="text-decoration-none text-dark d-block">
      <div class="card shadow-sm border-0">
        <div class="row g-0">
            
            <div class="col-md-4">
                {% set first_image = p.images|sort(attribute='position')|first %}
                {% if first_image %}
                    <img src="/{{ first_image.file_path }}" 
                         class="img-fluid rounded-start" 
                         alt="{{ p.dorm_name }}" 
                         style="height: 200px; width: 100%; object-fit: cover;">
                {% else %}
                    <div class="text-center d-flex justify-content-center align-items-center bg-light text-muted rounded-start" style="height: 200px;">[Image Placeholder]</div>
                {% endif %}
            </div>
            
            <div class="col-md-8">
                <div class="card-body d-flex flex-column h-100">
                    <div>
                        <h5 class="card-title text-truncate mb-1 d-flex align-items-center">
                            {{ p.dorm_name }}
                            {% if p.availability_status == 'vacant' %}
                                <span class="badge bg-success-subtle text-success-emphasis rounded-pill ms-2 small">ว่าง</span>
                            {% else %}
                                {# --- vvv ส่วนที่แก้ไข vvv --- #}
                                <span class="badge bg-danger text-white rounded-pill ms-2 small">เต็ม</span>
                                {# --- ^^^ สิ้นสุดการแก้ไข ^^^ --- #}
                            {% endif %}
                        </h5>
                        <div class="small text-muted">{{ p.room_type }}</div>
                    </div>
                    
                    <p class="text-primary h5 mt-2 mb-2">
                        {{ "{:,.0f}".format(p.rent_price) if p.rent_price is not none else 'N/A' }} THB / เดือน
                    </p>
                    <small class="text-muted">{{ p.road or 'N/A' }} Area</small>
                    
                    <div class="mt-auto pt-3">
                        <span class="btn btn-sm btn-outline-primary">ดูรายละเอียด</span>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </a>
  </div>
  {% else %}
  <div class="col"><div class="alert alert-secondary">ไม่มีข้อมูลประกาศที่ได้รับการอนุมัติในขณะนี้</div></div>
  {% endfor %}
</div>
{% endblock %}