{% extends 'owner/base.html' %}

{% block owner_content %}
<div class="d-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 fw-bold mb-0">Owner Dashboard</h1>
  <a class="btn btn-primary" href="{{ url_for('owner.new_property') }}">
    <i data-feather="plus" class="me-1" style="width:16px;"></i> สร้างประกาศใหม่
  </a>
</div>

<div class="card">
  <div class="card-header">
    รายการประกาศของคุณ
  </div>
  <div class="list-group list-group-flush">
    {% for p in props %}
    <div class="list-group-item d-flex justify-content-between align-items-center">
      <div class="flex-grow-1">
        <a href="{{ url_for('owner.edit_property', prop_id=p.id) }}" class="text-decoration-none text-dark fw-semibold">{{ p.dorm_name }}</a>
        <div class="small text-muted">Status: 
            {% if p.workflow_status == 'approved' %}
                <span class="badge bg-success-subtle text-success-emphasis rounded-pill">Approved</span>
            {% elif p.workflow_status == 'submitted' %}
                <span class="badge bg-warning-subtle text-warning-emphasis rounded-pill">Submitted</span>
            {% elif p.workflow_status == 'rejected' %}
                <span class="badge bg-danger-subtle text-danger-emphasis rounded-pill">Rejected</span>
            {% else %}
                <span class="badge bg-secondary-subtle text-secondary-emphasis rounded-pill">Draft</span>
            {% endif %}
        </div>
      </div>
      
      <div>
        {% if p.workflow_status == 'draft' or p.workflow_status == 'rejected' %}
        <form method="post" action="{{ url_for('owner.submit_for_approval', prop_id=p.id) }}" class="d-inline-block me-2" onsubmit="return confirm('คุณต้องการส่งประกาศนี้เพื่อขออนุมัติใช่หรือไม่?');">
          {{ submit_form.csrf_token }} 
          <button class="btn btn-sm btn-outline-info">ส่งอนุมัติ</button>
        </form>
        {% endif %}
        <a href="{{ url_for('owner.edit_property', prop_id=p.id) }}" class="btn btn-sm btn-outline-secondary">
            <i data-feather="edit-2" style="width:16px;"></i> แก้ไข
        </a>
      </div>
    </div>
    {% else %}
    <div class="list-group-item text-center text-muted p-5">
      ยังไม่มีประกาศ
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}