{% extends 'admin/base.html' %}

{% block admin_content %}
<h1 class="h3 mb-4 fw-bold">ประวัติการดำเนินการ (Audit Logs)</h1>

<div class="card shadow-sm border-0">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col">Log ID</th>
                        <th scope="col">ผู้ดำเนินการ</th>
                        <th scope="col">การกระทำ</th>
                        <th scope="col">Property ID</th>
                        <th scope="col">เวลา</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in items %}
                    <tr>
                        <th scope="row">{{ log.id }}</th>
                        <td>{{ log.actor_type.capitalize() }} #{{ log.actor_id }}</td>
                        <td>
                            <span class="badge 
                                {% if 'approve' in log.action %} bg-success-subtle text-success-emphasis
                                {% elif 'reject' in log.action %} bg-danger-subtle text-danger-emphasis
                                {% elif 'submit' in log.action %} bg-info-subtle text-info-emphasis
                                {% else %} bg-secondary-subtle text-secondary-emphasis
                                {% endif %}">
                                {{ log.action }}
                            </span>
                        </td>
                        <td>
                            {% if log.property_id %}
                                <a href="{{ url_for('admin.view_property', prop_id=log.property_id) }}">{{ log.property_id }}</a>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ log.created_at|to_bkk_time }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center text-muted py-5">
                            <i data-feather="activity" class="mb-3" style="width: 48px; height: 48px;"></i>
                            <h5 class="mb-0">ไม่พบประวัติการดำเนินการ</h5>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pagination -->
{% if pages > 1 %}
<nav aria-label="Page navigation" class="mt-4 d-flex justify-content-center">
    <ul class="pagination">
        <li class="page-item {% if page <= 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('admin.logs', page=page-1) }}">‹</a>
        </li>
        {% for page_num in range(1, pages + 1) %}
            <li class="page-item {% if page == page_num %}active{% endif %}">
                <a class="page-link" href="{{ url_for('admin.logs', page=page_num) }}">{{ page_num }}</a>
            </li>
        {% endfor %}
        <li class="page-item {% if page >= pages %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('admin.logs', page=page+1) }}">›</a>
        </li>
    </ul>
</nav>
{% endif %}

{% endblock %}