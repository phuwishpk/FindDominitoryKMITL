{% extends 'admin/base.html' %}

{% block admin_content %}

<h1 class="h4 mb-4">ประวัติการดำเนินการ (Audit Logs)</h1>

<div class="card shadow-sm">
<div class="card-body">
<div class="table-responsive">
<table class="table table-striped table-hover">
<thead class="table-light">
<tr>
<th scope="col">#ID</th>
<th scope="col">ผู้ดำเนินการ</th>
<th scope="col">การกระทำ</th>
<th scope="col">Property ID</th>
<th scope="col">หมายเหตุ/ข้อมูลเพิ่มเติม</th>
<th scope="col">เวลา</th>
</tr>
</thead>
<tbody>
{% for log in items %}
<tr>
<td>{{ log.id }}</td>
<td>
<span class="badge bg-{{ 'info' if log.actor_type == 'admin' else 'secondary' }}">
{{ log.actor_type.title() }}: {{ log.actor_id }}
</span>
</td>
<td>{{ log.action }}</td>
<td>
{% if log.property_id %}
<a href="{{ url_for('admin.review_property', prop_id=log.property_id) }}">{{ log.property_id }}</a>
{% else %}
N/A
{% endif %}
</td>
<td>
{% if log.meta and log.meta != 'null' %}
<pre class="mb-0 small bg-light p-1 rounded"><code>{{ log.meta }}</code></pre>
{% else %}
<span class="text-muted">-</span>
{% endif %}
</td>
<td>{{ log.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
</tr>
{% else %}
<tr>
<td colspan="6" class="text-center">ยังไม่มีประวัติการดำเนินการ</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>

<!-- Pagination -->
{% if pages > 1 %}
<div class="card-footer">
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mb-0">
            <li class="page-item {% if page == 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('admin.logs', page=page-1) }}">Previous</a>
            </li>
            {% for p in range(1, pages + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('admin.logs', page=p) }}">{{ p }}</a>
            </li>
            {% endfor %}
            <li class="page-item {% if page == pages %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('admin.logs', page=page+1) }}">Next</a>
            </li>
        </ul>
    </nav>
</div>
{% endif %}

</div>
{% endblock %}