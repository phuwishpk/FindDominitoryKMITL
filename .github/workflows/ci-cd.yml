# .github/workflows/ci-cd.yml

name: 'Build and Test'

on:
  push:
    branches: [ "project-improvement" , "main" , "develop-project" , "develop-admin" ]
  pull_request:
    branches: [ "project-improvement" , "main" , "develop-project" , "develop-admin" ]

jobs:
  # Job 1: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸¸à¸“à¸ à¸²à¸à¹‚à¸„à¹‰à¸”à¸”à¹‰à¸§à¸¢ Linter
  lint:
    name: 'ğŸ¨ Linting'
    runs-on: ubuntu-latest
    steps:
      - name: 'â¬‡ï¸ Check out code'
        uses: actions/checkout@v4

      - name: 'ğŸ Set up Python'
        uses: actions/setup-python@v5
        with:
          python-version-file: '.python-version'
          cache: 'pip'

      - name: 'âš™ï¸ Install dependencies'
        run: pip install ruff

      - name: 'ğŸ” Run Ruff Linter'
        run: ruff check .

  # Job 2: à¸£à¸±à¸™à¹€à¸—à¸ªà¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
  test:
    name: 'ğŸ§ª Testing'
    runs-on: ubuntu-latest
    needs: lint # à¸£à¸­à¹ƒà¸«à¹‰ Lint à¸œà¹ˆà¸²à¸™à¸à¹ˆà¸­à¸™à¸„à¹ˆà¸­à¸¢à¹€à¸£à¸´à¹ˆà¸¡ Test
    strategy:
      matrix:
        python-version: ["3.11", "3.12"]

    steps:
      - name: 'â¬‡ï¸ Check out code'
        uses: actions/checkout@v4

      - name: 'ğŸ Set up Python ${{ matrix.python-version }}'
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          cache: 'pip'

      - name: 'âš™ï¸ Install dependencies'
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest

      - name: 'ğŸ”¬ Run Pytest'
        run: pytest