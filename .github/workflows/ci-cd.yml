# .github/workflows/ci-cd.yml

name: 'Build, Test, and Deploy'

on:
  push:
    branches: [ "project-improvement" , "main", "develop-project", "develop-admin"]
  pull_request:
    branches: [ "project-improvement" , "main", "develop-project", "develop-admin"]

jobs:
  # Job 1: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏ß‡∏¢ Linter
  lint:
    name: 'üé® Linting'
    runs-on: ubuntu-latest
    steps:
      - name: '‚¨áÔ∏è Check out code'
        uses: actions/checkout@v4

      - name: 'üêç Set up Python'
        uses: actions/setup-python@v5
        with:
          python-version-file: '.python-version'
          cache: 'pip'

      - name: '‚öôÔ∏è Install dependencies'
        run: pip install ruff # Ruff ‡πÄ‡∏õ‡πá‡∏ô Linter ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ flake8 ‡∏°‡∏≤‡∏Å

      - name: 'üîé Run Ruff Linter'
        run: ruff check .

  # Job 2: ‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô Python ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô)
  test:
    name: 'üß™ Testing'
    runs-on: ubuntu-latest
    needs: lint # ‡∏£‡∏≠‡πÉ‡∏´‡πâ Lint ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏° Test
    strategy:
      matrix:
        python-version: ["3.11", "3.12"] # ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô Python 2 ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà Readme ‡∏£‡∏∞‡∏ö‡∏∏

    steps:
      - name: '‚¨áÔ∏è Check out code'
        uses: actions/checkout@v4

      - name: 'üêç Set up Python ${{ matrix.python-version }}'
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          cache: 'pip'

      - name: '‚öôÔ∏è Install dependencies'
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest # ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Library ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Test

      - name: 'üî¨ Run Pytest'
        run: pytest # ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏±‡∏ô‡πÄ‡∏ó‡∏™ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏ó‡∏™‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå)

  # Job 3: Deploy ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Render
  deploy:
    name: 'üöÄ Deploy to Render'
    runs-on: ubuntu-latest
    # ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á lint ‡πÅ‡∏•‡∏∞ test ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô
    needs: [lint, test]
    # ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô push ‡πÄ‡∏Ç‡πâ‡∏≤ branch ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    if: github.event_name == 'push'
    steps:
      - name: ' TRIGGER DEPLOY '
        run: curl -X POST ${{ secrets.RENDER_DEPLOY_HOOK }}